sub closeClaw(){
//this function will open the claw by rotating motor c forward
       OnFwd(OUT_C, 50);
       Wait(500);
       Off(OUT_C);
       //RotateMotor(OUT_C, 50, 150);
}

sub openClaw(){
//closes the claw by rotating motor c backward
    //RotateMotor(OUT_C, 50, -150);
    OnRev(OUT_C, 50);
    Wait(500);
    Off(OUT_C);
}

sub avoid(){
//avaoid checks 30cm in front, it obstacle, turns 45 degrees left
    const int THRESHOLD = 30;

    SetSensorLowspeed(IN_2);
    if(SensorUS(IN_2) < THRESHOLD){
         Off(OUT_AB);
         RotateMotor(OUT_A, -75, 180);
    }

}

bool getTrash(){
//if the touch sensor is pressed, the claw will close locking the trash in a death grip

SetSensorColorFull(IN_1);
//if (!haveTrash){
    if(Sensor(IN_1)==2 || Sensor(IN_1)==4){     //if the color is blue or yellow closeClaw()
         Off(OUT_AB);
         closeClaw();
         return true;
    }
//}
    else{
    //haveTrash = false;      //this may not work
    }
}

bool findDumpsite(){
//robot will rotate looking for light. If the light value is greater than the
//threshold, the robot will stop looking and move toward the light

    const int THRESHOLD = 50;    //Sets the value of the light threshold

    SetSensorLight(IN_4);
    while(Sensor(IN_4) < THRESHOLD){        //robot will spin until it finds light intensity > threshold
         OnFwd(OUT_A, 50);
         OnRev(OUT_B, 50);
    }
    while(Sensor(IN_4) > THRESHOLD){        //when the light intensity > threshold start moving toward light
         OnFwd(OUT_AB,50);
         avoid();
         if(Sensor(IN_4) > 90){             //if intensity > 90 we're close enough and return true
             return true;                   //true will tell the bot that we have arrived to dumpsite
         }                                  //and initiate dropOff procedure
    }


}

bool dropOff(){
    if(findDumpsite()){
        Off(OUT_AB);                        //turns off wheels for placement of trash
        openClaw();
        Wait(1000);                         //opens claw (duh)
        RotateMotor(OUT_AB, 50, -180);       //robot backs away from trash
        RotateMotor(OUT_A, 50, 360);        //robot makes 90 degree turn, hopefully
    }
}


task main(){
   while(true){
        OnFwd(OUT_AB, 75);
        avoid();
        bool yes = getTrash();
        if(yes){
             Wait(1000);  //pauses befor dropoff
             dropOff();   //need to reset getTrash() to false b/c it is constantly
                          //looking to drop off without trash
                          //also once the light has been located, the bot turns slow
                          //instead of moving toward the light.
        yes = false;      //should reset

        }
   }

/*bool yes =false;
while (!yes)
      {
      yes = getTrash();
      }
findDumpsite();
*/

}
